# Check that R version 4.1.3
if (as.character(getRversion()) != "4.1.3") {
    stop("R version 4.1.3 is required")
}

# set CRAN mirror to London
options(repos = c(CRAN = "https://cran.ma.imperial.ac.uk/"))

# Install specific versions of CRAN packages
install_version <- function(package, version) {
    # Check if devtools is installed, if not install it
    if (!requireNamespace("devtools", quietly = TRUE)) {
        install.packages("devtools")
    }

    # Use devtools to install specific version
    devtools::install_version(package, version)
}

# Function to compare installed version with desired version
check_version <- function(package, version) {
    installed_version <- as.character(packageVersion(package))
    message(
        sprintf(
            "Package: %s, Installed Version: %s, Expected Version: %s, Match: %s",
            package, installed_version, version, installed_version == version)
    )
}

package_versions <- c(
    # ade4 = "1.7-20",
    ape = "5.6-2",
    # aplot = "0.1.8",
    # argparse = "2.1.6",
    # BiocGenerics = "0.40.0",
    # BiocManager = "1.30.19",
    # BiocParallel = "1.28.3",
    # BiocVersion = "3.14.0",
    # Biostrings = "2.62.0",
    # findpython = "1.0.7",
    # formatR = "1.12",
    # futile.logger = "1.4.3",
    # futile.options = "1.0.1",
    # GenomeInfoDb = "1.30.1",
    # GenomeInfoDbData = "1.2.7",
    # GenomicRanges = "1.46.1",
    # getopt = "1.20.3",
    # ggfun = "0.0.8",
    # ggplotify = "0.1.0",
    # ggtree = "3.2.1",
    # gridGraphics = "0.5-1",
    # IRanges = "2.28.0",
    # lambda.r = "1.2.4",
    optparse = "1.7.3",
    # pixmap = "0.4-12",
    # Rcpp = "1.0.9",
    # RCurl = "1.98-1.9",
    # Rhtslib = "1.26.0",
    # Rsamtools = "2.10.0",
    # S4Vectors = "0.32.4",
    # segmented = "1.6-1",
    seqinr = "4.2-16",
    # snow = "0.4-4",
    # tidytree = "0.4.1",
    # treeio = "1.18.1",
    # treemut = "1.1",
    VGAM = "1.1-7",
    # XVector = "0.34.0",
    # yulab.utils = "0.0.5",
    # zlibbioc = "1.40.0",
    # abind = "1.4-5",
    # askpass = "1.1",
    # base = "4.1.3",
    # base64enc = "0.1-3",
    # beeswarm = "0.4.0",
    # BH = "1.78.0-0",
    BiocManager = "1.30.18",
    # bit = "4.0.5",
    # bit64 = "4.0.5",
    # bitops = "1.0-7",
    # boot = "1.3-28",
    # brew = "1.0-7",
    # brio = "1.1.3",
    # bslib = "0.3.1",
    # cachem = "1.0.6",
    # Cairo = "1.5-15",
    # callr = "3.7.0",
    # caTools = "1.18.2",
    # class = "7.3-20",
    # cli = "3.3.0",
    # clipr = "0.8.0",
    # cluster = "2.1.2",
    # codetools = "0.2-18",
    # colorspace = "2.0-3",
    # commonmark = "1.8.0",
    # compiler = "4.1.3",
    # coro = "1.0.3",
    # cowplot = "1.1.1",
    # cpp11 = "0.4.2",
    # crayon = "1.5.1",
    # credentials = "1.3.2",
    # crosstalk = "1.2.0",
    # curl = "4.3.2",
    data.table = "1.14.2",
    # datasets = "4.1.3",
    # deldir = "1.0-6",
    # desc = "1.4.1",
    # devtools = "2.4.3",
    # diffobj = "0.3.5",
    # digest = "0.6.29",
    dplyr = "1.0.9",
    # dqrng = "0.3.0",
    # ellipsis = "0.3.2",
    # evaluate = "0.15",
    # fansi = "1.0.3",
    # farver = "2.1.0",
    # fastmap = "1.1.0",
    # fitdistrplus = "1.1-8",
    # FNN = "1.1.3",
    # fontawesome = "0.2.2",
    # foreign = "0.8-82",
    # fs = "1.5.2",
    # future = "1.25.0",
    # future.apply = "1.9.0",
    # generics = "0.1.2",
    # gert = "1.6.0",
    # ggbeeswarm = "0.6.0",
    ggplot2 = "3.3.6",
    # ggrepel = "0.9.1",
    # ggridges = "0.5.3",
    # gh = "1.3.0",
    # gitcreds = "0.1.1",
    # globals = "0.15.0",
    # glue = "1.6.2,",
    # goftest = "1.2-3",
    # gplots = "3.1.3",
    # graphics = "4.1.3",
    # grDevices = "4.1.3",
    # grid = "4.1.3",
    # gridExtra = "2.3",
    # gtable = "0.3.0",
    # gtools = "3.9.2",
    # here = "1.0.1",
    # highr = "0.9",
    # htmltools = "0.5.2",
    # htmlwidgets = "1.5.4",
    # httpuv = "1.6.5",
    # httr = "1.4.3",
    # ica = "1.0-2",
    # igraph = "1.3.1",
    # ini = "0.3.1",
    # irlba = "2.3.5",
    # isoband = "0.2.5",
    # jquerylib = "0.1.4",
    # jsonlite = "1.8.0",
    # KernSmooth = "2.23-20",
    # knitr = "1.39",
    # labeling = "0.4.2",
    # later = "1.3.0",
    # lattice = "0.20-45",
    # lazyeval = "0.2.2",
    # leiden = "0.4.2",
    # lifecycle = "1.0.1",
    # listenv = "0.8.0",
    # lmtest = "0.9-40",
    # magrittr = "2.0.3",
    MASS = "7.3-55",
    # Matrix = "1.4-0",
    # matrixStats = "0.62.0",
    # memoise = "2.0.1",
    # methods = "4.1.3",
    # mgcv = "1.8-39",
    # mime = "0.12",
    # miniUI = "0.1.1.1",
    # munsell = "0.5.0",
    # nlme = "3.1-155",
    # nnet = "7.3-17",
    # openssl = "2.0.1",
    # parallel = "4.1.3",
    # parallelly = "1.31.1",
    # patchwork = "1.1.1",
    # pbapply = "1.5-0",
    # pillar = "1.7.0",
    # pkgbuild = "1.3.1",
    # pkgconfig = "2.0.3",
    # pkgload = "1.2.4",
    # plotly = "4.10.0",
    # plyr = "1.8.7",
    # png = "0.1-7",
    # polyclip = "1.10-0",
    # praise = "1.0.0",
    # prettyunits = "1.1.1",
    # processx = "3.5.3",
    # progressr = "0.10.0",
    # promises = "1.2.0.1",
    # ps = "1.7.0",
    # purrr = "0.3.4",
    # R6 = "2.5.1",
    # RANN = "2.6.1",
    # rappdirs = "0.3.3",
    # rcmdcheck = "1.4.0",
    # RColorBrewer = "1.1-3",
    # Rcpp = "1.0.8.3",
    # RcppAnnoy = "0.0.19",
    # RcppArmadillo = "0.11.1.1.0",
    # RcppEigen = "0.3.3.9.2",
    # RcppProgress = "0.4.2",
    # RcppTOML = "0.1.7",
    # rematch2 = "2.1.2",
    # remotes = "2.4.2",
    # reshape2 = "1.4.4",
    # reticulate = "1.25",
    # rgeos = "0.5-9",
    # rlang = "1.0.2",
    # ROCR = "1.0-11",
    # roxygen2 = "7.2.0",
    # rpart = "4.1.16",
    # rprojroot = "2.0.3",
    # RSpectra = "0.16-1",
    # rstudioapi = "0.13",
    # Rtsne = "0.16",
    # rversions = "2.1.1",
    # sass = "0.4.1",
    # scales = "1.2.0",
    # scattermore = "0.8",
    # sctransform = "0.3.3",
    # sessioninfo = "1.2.2",
    # Seurat = "4.1.1",
    # SeuratObject = "4.1.0",
    # shiny = "1.7.1",
    # sitmo = "2.0.2",
    # sourcetools = "0.1.7",
    # sp = "1.4-7",
    # spatial = "7.3-15",
    # spatstat.core = "2.4-2",
    # spatstat.data = "2.2-0",
    # spatstat.geom = "2.4-0",
    # spatstat.random = "2.2-0",
    # spatstat.sparse = "2.1-1",
    # spatstat.utils = "2.3-1",
    # splines = "4.1.3",
    # stats = "4.1.3",
    # stats4 = "4.1.3",
    # stringi = "1.7.6",
    stringr = "1.4.0",
    # survival = "3.2-13",
    # sys = "3.4",
    # systemfonts = "1.0.4",
    # tcltk = "4.1.3",
    # tensor = "1.5",
    # testthat = "3.1.4",
    # tibble = "3.1.7",
    tidyr = "1.2.0" # ,
    # tidyselect = "1.1.2",
    # tools = "4.1.3",
    # torch = "0.10.0",
    # usethis = "2.1.5",
    # utf8 = "1.2.2",
    # utils = "4.1.3",
    # uwot = "0.1.11",
    # vctrs = "0.4.1",
    # vipor = "0.4.5",
    # viridisLite = "0.4.0",
    # waldo = "0.4.0",
    # whisker = "0.4",
    # withr = "2.5.0",
    # xfun = "0.31",
    # xml2 = "1.3.3",
    # xopen = "1.0.0",
    # xtable = "1.8-4",
    # yaml = "2.3.5",
    # zip = "2.2.0",
    # zoo = "1.8-10"
)

# Install CRAN packages
lapply(names(package_versions), function(pkg) install_version(pkg, package_versions[pkg]))

# Apply the function to each package
lapply(names(package_versions), function(pkg) check_version(pkg, package_versions[pkg]))

# Install Bioconductor package
# if (!requireNamespace("BiocManager", quietly = TRUE)) {
#     install.packages("BiocManager")
# }

# BiocManager::install("BiocManager", version = "1.30")


bioconductor_packages <- c(
    # ade4 = "1.7-20",
    # ape = "5.6-2",
    # aplot = "0.1.8",
    # argparse = "2.1.6",
    # BiocGenerics = "0.40.0",
    # BiocManager = "1.30.19",
    # BiocParallel = "1.28.3",
    # BiocVersion = "3.14.0",
    # Biostrings = "2.62.0",
    # findpython = "1.0.7",
    # formatR = "1.12",
    # futile.logger = "1.4.3",
    # futile.options = "1.0.1",
    # GenomeInfoDb = "1.30.1",
    # GenomeInfoDbData = "1.2.7",
    GenomicRanges = "1.46.1",
    # getopt = "1.20.3",
    # ggfun = "0.0.8",
    # ggplotify = "0.1.0",
    ggtree = "3.2.1",
    # gridGraphics = "0.5-1",
    # IRanges = "2.28.0",
    # lambda.r = "1.2.4",
    # optparse = "1.7.3",
    # pixmap = "0.4-12",
    # Rcpp = "1.0.9",
    # RCurl = "1.98-1.9",
    # Rhtslib = "1.26.0",
    Rsamtools = "2.10.0" # ,
    # S4Vectors = "0.32.4",
    # segmented = "1.6-1",
    # seqinr = "4.2-16",
    # snow = "0.4-4",
    # tidytree = "0.4.1",
    # treeio = "1.18.1",
    # treemut = "1.1",
    # VGAM = "1.1-7",
    # XVector = "0.34.0",
    # yulab.utils = "0.0.5",
    # zlibbioc = "1.40.0",
    # abind = "1.4-5",
    # askpass = "1.1",
    # base = "4.1.3",
    # base64enc = "0.1-3",
    # beeswarm = "0.4.0",
    # BH = "1.78.0-0",
    # BiocManager = "1.30.18",
    # bit = "4.0.5",
    # bit64 = "4.0.5",
    # bitops = "1.0-7",
    # boot = "1.3-28",
    # brew = "1.0-7",
    # brio = "1.1.3",
    # bslib = "0.3.1",
    # cachem = "1.0.6",
    # Cairo = "1.5-15",
    # callr = "3.7.0",
    # caTools = "1.18.2",
    # class = "7.3-20",
    # cli = "3.3.0",
    # clipr = "0.8.0",
    # cluster = "2.1.2",
    # codetools = "0.2-18",
    # colorspace = "2.0-3",
    # commonmark = "1.8.0",
    # compiler = "4.1.3",
    # coro = "1.0.3",
    # cowplot = "1.1.1",
    # cpp11 = "0.4.2",
    # crayon = "1.5.1",
    # credentials = "1.3.2",
    # crosstalk = "1.2.0",
    # curl = "4.3.2",
    # data.table = "1.14.2",
    # datasets = "4.1.3",
    # deldir = "1.0-6",
    # desc = "1.4.1",
    # devtools = "2.4.3",
    # diffobj = "0.3.5",
    # digest = "0.6.29",
    # dplyr = "1.0.9",
    # dqrng = "0.3.0",
    # ellipsis = "0.3.2",
    # evaluate = "0.15",
    # fansi = "1.0.3",
    # farver = "2.1.0",
    # fastmap = "1.1.0",
    # fitdistrplus = "1.1-8",
    # FNN = "1.1.3",
    # fontawesome = "0.2.2",
    # foreign = "0.8-82",
    # fs = "1.5.2",
    # future = "1.25.0",
    # future.apply = "1.9.0",
    # generics = "0.1.2",
    # gert = "1.6.0",
    # ggbeeswarm = "0.6.0",
    # ggplot2 = "3.3.6",
    # ggrepel = "0.9.1",
    # ggridges = "0.5.3",
    # gh = "1.3.0",
    # gitcreds = "0.1.1",
    # globals = "0.15.0",
    # glue = "1.6.2",
    # goftest = "1.2-3",
    # gplots = "3.1.3",
    # graphics = "4.1.3",
    # grDevices = "4.1.3",
    # grid = "4.1.3",
    # gridExtra = "2.3",
    # gtable = "0.3.0",
    # gtools = "3.9.2",
    # here = "1.0.1",
    # highr = "0.9",
    # htmltools = "0.5.2",
    # htmlwidgets = "1.5.4",
    # httpuv = "1.6.5",
    # httr = "1.4.3",
    # ica = "1.0-2",
    # igraph = "1.3.1",
    # ini = "0.3.1",
    # irlba = "2.3.5",
    # isoband = "0.2.5",
    # jquerylib = "0.1.4",
    # jsonlite = "1.8.0",
    # KernSmooth = "2.23-20",
    # knitr = "1.39",
    # labeling = "0.4.2",
    # later = "1.3.0",
    # lattice = "0.20-45",
    # lazyeval = "0.2.2",
    # leiden = "0.4.2",
    # lifecycle = "1.0.1",
    # listenv = "0.8.0",
    # lmtest = "0.9-40",
    # magrittr = "2.0.3",
    # MASS = "7.3-55",
    # Matrix = "1.4-0",
    # matrixStats = "0.62.0",
    # memoise = "2.0.1",
    # methods = "4.1.3",
    # mgcv = "1.8-39",
    # mime = "0.12",
    # miniUI = "0.1.1.1",
    # munsell = "0.5.0",
    # nlme = "3.1-155",
    # nnet = "7.3-17",
    # openssl = "2.0.1",
    # parallel = "4.1.3",
    # parallelly = "1.31.1",
    # patchwork = "1.1.1",
    # pbapply = "1.5-0",
    # pillar = "1.7.0",
    # pkgbuild = "1.3.1",
    # pkgconfig = "2.0.3",
    # pkgload = "1.2.4",
    # plotly = "4.10.0",
    # plyr = "1.8.7",
    # png = "0.1-7",
    # polyclip = "1.10-0",
    # praise = "1.0.0",
    # prettyunits = "1.1.1",
    # processx = "3.5.3",
    # progressr = "0.10.0",
    # promises = "1.2.0.1",
    # ps = "1.7.0",
    # purrr = "0.3.4",
    # R6 = "2.5.1",
    # RANN = "2.6.1",
    # rappdirs = "0.3.3",
    # rcmdcheck = "1.4.0",
    # RColorBrewer = "1.1-3",
    # Rcpp = "1.0.8.3",
    # RcppAnnoy = "0.0.19",
    # RcppArmadillo = "0.11.1.1.0",
    # RcppEigen = "0.3.3.9.2",
    # RcppProgress = "0.4.2",
    # RcppTOML = "0.1.7",
    # rematch2 = "2.1.2",
    # remotes = "2.4.2",
    # reshape2 = "1.4.4",
    # reticulate = "1.25",
    # rgeos = "0.5-9",
    # rlang = "1.0.2",
    # ROCR = "1.0-11",
    # roxygen2 = "7.2.0",
    # rpart = "4.1.16",
    # rprojroot = "2.0.3",
    # RSpectra = "0.16-1",
    # rstudioapi = "0.13",
    # Rtsne = "0.16",
    # rversions = "2.1.1",
    # sass = "0.4.1",
    # scales = "1.2.0",
    # scattermore = "0.8",
    # sctransform = "0.3.3",
    # sessioninfo = "1.2.2",
    # Seurat = "4.1.1",
    # SeuratObject = "4.1.0",
    # shiny = "1.7.1",
    # sitmo = "2.0.2",
    # sourcetools = "0.1.7",
    # sp = "1.4-7",
    # spatial = "7.3-15",
    # spatstat.core = "2.4-2",
    # spatstat.data = "2.2-0",
    # spatstat.geom = "2.4-0",
    # spatstat.random = "2.2-0",
    # spatstat.sparse = "2.1-1",
    # spatstat.utils = "2.3-1",
    # splines = "4.1.3",
    # stats = "4.1.3",
    # stats4 = "4.1.3",
    # stringi = "1.7.6",
    # stringr = "1.4.0",
    # survival = "3.2-13",
    # sys = "3.4",
    # systemfonts = "1.0.4",
    # tcltk = "4.1.3",
    # tensor = "1.5",
    # testthat = "3.1.4",
    # tibble = "3.1.7",
    # tidyr = "1.2.0",
    # tidyselect = "1.1.2",
    # tools = "4.1.3",
    # torch = "0.10.0",
    # usethis = "2.1.5",
    # utf8 = "1.2.2",
    # utils = "4.1.3",
    # uwot = "0.1.11",
    # vctrs = "0.4.1",
    # vipor = "0.4.5",
    # viridisLite = "0.4.0",
    # waldo = "0.4.0",
    # whisker = "0.4",
    # withr = "2.5.0",
    # xfun = "0.31",
    # xml2 = "1.3.3",
    # xopen = "1.0.0",
    # xtable = "1.8-4",
    # yaml = "2.3.5",
    # zip = "2.2.0",
    # zoo = "1.8-10"
)

lapply(
    names(bioconductor_packages),
    function(pkg) BiocManager::install(
        pkg
    )
)

lapply(
    names(bioconductor_packages),
    function(pkg) check_version(pkg, bioconductor_packages[pkg])
)


